<div class="portfolio-container">
  <!-- Header -->
  <header class="portfolio-header">
    <button 
      class="theme-toggle-btn" 
      (click)="toggleTheme()"
      [attr.aria-label]="t().changeThemeToLight"
      [title]="t().changeTheme">
      <img 
        [src]="currentTheme === 'dark' ? 'assets/img/Cambio_tema/sun.png' : 'assets/img/Cambio_tema/moon.png'" 
        [alt]="currentTheme === 'dark' ? t().changeThemeToLight : t().changeThemeToDark"
        class="theme-icon">
    </button>
    <div class="name-section">
      @if (editingCvUrl()) {
        <div class="cv-url-edit-form">
          <input type="text" [(ngModel)]="editCvUrlForm" placeholder="URL del CV" class="cv-url-input">
          <div class="cv-url-actions">
            <button class="save-btn" (click)="saveCvUrl()">Guardar</button>
            @if (cvUrl()) {
              <button class="delete-btn" (click)="deleteCvUrl()" title="Eliminar URL">üóëÔ∏è</button>
            }
            <button class="cancel-btn" (click)="cancelEditCvUrl()">Cancelar</button>
          </div>
        </div>
      } @else {
        @if (cvUrl()) {
          <a [href]="cvUrl()" target="_blank" class="cv-download-btn" title="Descargar curriculum">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span class="cv-tooltip">Descargar curriculum</span>
          </a>
        }
        @if (isAuthenticated) {
          <button class="edit-cv-url-btn" (click)="startEditCvUrl()" title="Editar URL del CV">‚úèÔ∏è</button>
        }
      }
      <h1 class="full-name">{{ fullName }}</h1>
    </div>
  </header>

  <!-- Secci√≥n Principal - 3 Columnas -->
  <main class="portfolio-main">
    <!-- Columna Central - Informaci√≥n Personal (Primera en m√≥vil) -->
    <section class="portfolio-column center-column mobile-first">
      <!-- Bot√≥n "M√°s sobre m√≠" -->
      <button class="about-me-btn" (click)="openModal()">
        <h2>{{ t().aboutMe }}</h2>
        <span class="btn-icon">‚Üí</span>
      </button>
      
      <!-- Imagen de Perfil -->
      <div class="profile-image-container">
        <img 
          [src]="profileImage" 
          alt="Jhojan Danilo Toro Perez" 
          class="profile-image"
          loading="lazy">
      </div>
    </section>

    <!-- Columna Izquierda - Proyectos -->
    <section class="portfolio-column projects-column" [class.mobile-visible]="showProjects()">
      <div class="column-header">
        <h2>{{ t().projects }}</h2>
        <div class="header-actions">
          <div class="sort-dropdown">
            <button class="sort-btn" (click)="toggleSortMenu()" title="Ordenar proyectos">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M7 12h10M11 18h2"/>
              </svg>
            </button>
            @if (showSortMenu()) {
              <div class="sort-menu">
                <button class="sort-option" [class.active]="projectSortOrder() === 'default'" (click)="setSortOrder('default')">
                  Por defecto
                </button>
                <button class="sort-option" [class.active]="projectSortOrder() === 'name-asc'" (click)="setSortOrder('name-asc')">
                  Nombre A-Z
                </button>
                <button class="sort-option" [class.active]="projectSortOrder() === 'name-desc'" (click)="setSortOrder('name-desc')">
                  Nombre Z-A
                </button>
                <button class="sort-option" [class.active]="projectSortOrder() === 'state-asc'" (click)="setSortOrder('state-asc')">
                  Estado A-Z
                </button>
                <button class="sort-option" [class.active]="projectSortOrder() === 'state-desc'" (click)="setSortOrder('state-desc')">
                  Estado Z-A
                </button>
                <button class="sort-option" [class.active]="projectSortOrder() === 'recent-first'" (click)="setSortOrder('recent-first')">
                  M√°s reciente primero
                </button>
                <button class="sort-option" [class.active]="projectSortOrder() === 'oldest-first'" (click)="setSortOrder('oldest-first')">
                  M√°s antiguo primero
                </button>
              </div>
            }
          </div>
          @if (isEditMode()) {
            <button class="edit-add-btn" (click)="startAddProject()" title="Agregar proyecto">+</button>
          }
        </div>
      </div>
      <div class="projects-list">
        @if (editingProjectIndex() === -1) {
          <!-- Formulario para nuevo proyecto -->
          <div class="edit-form-card">
            <h4>Nuevo Proyecto</h4>
            <input type="text" [(ngModel)]="editProjectForm().name" placeholder="Nombre" class="form-input">
            <input type="text" [(ngModel)]="editProjectForm().tool" placeholder="Herramienta" class="form-input">
            <input type="text" [(ngModel)]="editProjectForm().url" placeholder="URL" class="form-input">
            <input type="text" [(ngModel)]="editProjectForm().state" placeholder="Estado" class="form-input">
            <input type="text" [(ngModel)]="editProjectForm().img" placeholder="Imagen" class="form-input">
            <div class="edit-actions">
              <button class="save-btn" (click)="addProject()">Guardar</button>
              <button class="cancel-btn" (click)="cancelEditProject()">Cancelar</button>
            </div>
          </div>
        }
        
        @for (project of sortedProjects(); track project.name; let i = $index) {
          @if (getEditingProjectName() === project.name) {
            <!-- Formulario de edici√≥n -->
            <div class="edit-form-card">
              <h4>Editar Proyecto</h4>
              <input type="text" [(ngModel)]="editProjectForm().name" placeholder="Nombre" class="form-input">
              <input type="text" [(ngModel)]="editProjectForm().tool" placeholder="Herramienta" class="form-input">
              <input type="text" [(ngModel)]="editProjectForm().url" placeholder="URL" class="form-input">
              <input type="text" [(ngModel)]="editProjectForm().state" placeholder="Estado" class="form-input">
              <input type="text" [(ngModel)]="editProjectForm().img" placeholder="Imagen" class="form-input">
              <div class="edit-actions">
                <button class="save-btn" (click)="saveProject(project.name)">Guardar</button>
                <button class="cancel-btn" (click)="cancelEditProject()">Cancelar</button>
              </div>
            </div>
          } @else {
            <div class="project-card" [class.edit-mode]="isEditMode()">
              @if (isEditMode()) {
                <div class="edit-controls">
                  <button class="edit-btn" (click)="startEditProject(project.name); $event.stopPropagation()" title="Editar">‚úèÔ∏è</button>
                  <button class="delete-btn" (click)="deleteProject(project.name); $event.stopPropagation()" title="Eliminar">üóëÔ∏è</button>
                </div>
              }
              <div class="project-content" (click)="openProject(project.url)">
                <div class="project-image">
                  <img [src]="project.img" [alt]="project.name" loading="lazy">
                </div>
                <div class="project-info">
                  <h3>{{ project.name }}</h3>
                  <p class="project-tool">{{ project.tool }}</p>
                  <span class="project-state" [class.active]="project.state.toLowerCase() === 'active' || project.state.toLowerCase() === 'activo'">
                    {{ project.state }}
                  </span>
                </div>
              </div>
            </div>
          }
        }
      </div>
    </section>

    <!-- Columna Derecha - Habilidades -->
    <section class="portfolio-column skills-column" [class.mobile-visible]="showSkills()">
      <div class="column-header">
        <h2>{{ t().skills }}</h2>
        @if (isEditMode()) {
          <button class="edit-add-btn" (click)="startAddSkill()" title="Agregar habilidad">+</button>
        }
      </div>
      
      <!-- Formulario para agregar nueva habilidad -->
      @if (isAddingSkill()) {
        <div class="edit-form-card">
          <h4>Nueva Habilidad</h4>
          <select [(ngModel)]="newSkillType" class="form-input">
            <option value="blanda">Habilidad Blanda</option>
            <option value="dura">Habilidad Dura</option>
          </select>
          
          @if (newSkillType() === 'blanda') {
            <input type="text" [(ngModel)]="newSkillForm().name" placeholder="Nombre de la habilidad" class="form-input">
          } @else {
            <input type="text" [(ngModel)]="newSkillForm().name" placeholder="Nombre" class="form-input">
            <input type="text" [(ngModel)]="newSkillForm().img" placeholder="Ruta de imagen" class="form-input">
            <input type="text" [(ngModel)]="newSkillForm().url" placeholder="URL (opcional)" class="form-input">
          }
          
          <div class="edit-actions">
            <button class="save-btn" (click)="saveNewSkill()">Guardar</button>
            <button class="cancel-btn" (click)="cancelAddSkill()">Cancelar</button>
          </div>
        </div>
      }
      
      <div class="skills-content">
        <!-- Secci√≥n √∫nica de habilidades -->
        <div class="skill-group">
          <!-- Habilidades Duras -->
          @for (skillGroup of translatedSkills(); track skillGroup.h2; let i = $index) {
            @if (skillGroup.itemsObject) {
              <div class="skill-subsection">
                <div class="skill-subsection-header">
                  <h3 class="skill-subtitle">{{ t().hardSkills }}</h3>
                </div>
                
                <!-- Formulario para agregar habilidad dura -->
                @if (addingSkillObject() === i) {
                  <div class="edit-form-card">
                    <input type="text" [(ngModel)]="editSkillObjectForm().name" placeholder="Nombre" class="form-input">
                    <input type="text" [(ngModel)]="editSkillObjectForm().img" placeholder="Ruta de imagen" class="form-input">
                    <input type="text" [(ngModel)]="editSkillObjectForm().url" placeholder="URL (opcional)" class="form-input">
                    <div class="edit-actions">
                      <button class="save-btn" (click)="addSkillObject(i)">Guardar</button>
                      <button class="cancel-btn" (click)="cancelAddSkillObject()">Cancelar</button>
                    </div>
                  </div>
                }
                
                <div class="skills-list">
                  @for (skillObj of skillGroup.itemsObject; track skillObj.name; let j = $index) {
                    @if (editingSkillGroupIndex() === i && editingSkillObjectIndex() === j) {
                      <!-- Formulario de edici√≥n de habilidad dura -->
                      <div class="edit-form-card">
                        <input type="text" [(ngModel)]="editSkillObjectForm().name" placeholder="Nombre" class="form-input">
                        <input type="text" [(ngModel)]="editSkillObjectForm().img" placeholder="Ruta de imagen" class="form-input">
                        <input type="text" [(ngModel)]="editSkillObjectForm().url" placeholder="URL (opcional)" class="form-input">
                        <div class="edit-actions">
                          <button class="save-btn" (click)="saveSkillObject()">Guardar</button>
                          <button class="cancel-btn" (click)="cancelEditSkillObject()">Cancelar</button>
                        </div>
                      </div>
                    } @else {
                      <div class="skill-item-object" [class.edit-mode]="isAuthenticated">
                        @if (skillObj.img) {
                          <img [src]="skillObj.img" [alt]="skillObj.name" class="skill-icon">
                        }
                        <span>{{ skillObj.name }}</span>
                        @if (isAuthenticated) {
                          <div class="skill-object-controls">
                            <button class="edit-skill-btn" (click)="startEditSkillObject(i, j)" title="Editar">‚úèÔ∏è</button>
                            <button class="delete-skill-btn" (click)="deleteSkillObject(i, j)" title="Eliminar">üóëÔ∏è</button>
                          </div>
                        }
                      </div>
                    }
                  }
                </div>
              </div>
            }
          }
          
          <!-- Habilidades Blandas -->
          @for (skillGroup of translatedSkills(); track skillGroup.h2; let i = $index) {
            @if (skillGroup.items) {
              <div class="skill-subsection">
                <div class="skill-subsection-header">
                  <h3 class="skill-subtitle">{{ t().softSkills }}</h3>
                </div>
                
                <!-- Formulario para agregar habilidad blanda -->
                @if (addingSkillItem() === i) {
                  <div class="edit-form-card">
                    <input type="text" [(ngModel)]="editSkillForm" placeholder="Nombre de la habilidad" class="form-input">
                    <div class="edit-actions">
                      <button class="save-btn" (click)="addSkillItem(i)">Guardar</button>
                      <button class="cancel-btn" (click)="cancelAddSkillItem()">Cancelar</button>
                    </div>
                  </div>
                }
                
                <div class="skills-list">
                  @for (skill of skillGroup.items; track skill; let j = $index) {
                    @if (editingSkillGroupIndex() === i && editingSkillItemIndex() === j) {
                      <!-- Formulario de edici√≥n de habilidad blanda -->
                      <div class="edit-form-card">
                        <input type="text" [(ngModel)]="editSkillForm" placeholder="Nombre" class="form-input">
                        <div class="edit-actions">
                          <button class="save-btn" (click)="saveSkillItem()">Guardar</button>
                          <button class="cancel-btn" (click)="cancelEditSkillItem()">Cancelar</button>
                        </div>
                      </div>
                    } @else {
                      <span class="skill-chip" [class.edit-mode]="isAuthenticated">
                        {{ skill }}
                        @if (isAuthenticated) {
                          <div class="skill-chip-controls">
                            <button class="edit-skill-btn" (click)="startEditSkillItem(i, j)" title="Editar">‚úèÔ∏è</button>
                            <button class="delete-skill-btn" (click)="deleteSkillItem(i, j)" title="Eliminar">√ó</button>
                          </div>
                        }
                      </span>
                    }
                  }
                </div>
              </div>
            }
          }
        </div>
      </div>
    </section>
  </main>

  <!-- Modal "M√°s sobre m√≠" -->
  <app-modal
    [isOpen]="isModalOpen"
    [title]="t().modalTitle"
    [contents]="translatedContents()"
    [isEditMode]="isAuthenticated"
    [editingContentIndex]="editingContentIndex()"
    [editingContentItemIndex]="editingContentItemIndex()"
    [editContentForm]="editContentForm()"
    (close)="closeModal()"
    (startEdit)="startEditContentItem($event.contentIndex, $event.itemIndex)"
    (cancelEdit)="cancelEditContentItem()"
    (saveEdit)="saveContentItem()"
    (deleteItem)="deleteContentItem($event.contentIndex, $event.itemIndex)"
    (startAdd)="startAddContentItem($event)"
    (saveAdd)="addContentItem()">
  </app-modal>

  <!-- Bot√≥n de cambio de idioma -->
  <button 
    class="language-toggle-btn" 
    (click)="toggleLanguage()"
    [attr.aria-label]="currentLanguage === 'es' ? 'Change to English' : 'Cambiar a Espa√±ol'"
    [title]="currentLanguage === 'es' ? 'EN' : 'ES'">
    <span class="language-code">{{ currentLanguage === 'es' ? 'EN' : 'ES' }}</span>
  </button>
  
  <!-- Bot√≥n de Logout en la parte inferior izquierda -->
  @if (isAuthenticated) {
    <button class="logout-btn" (click)="logout()" title="Cerrar sesi√≥n">
      Logout
    </button>
  }

  <!-- Botones de navegaci√≥n m√≥vil -->
  <div class="mobile-navigation-buttons">
    <button class="mobile-nav-btn" (click)="toggleProjects()" [class.active]="showProjects()">
      <span>{{ t().projects }}</span>
    </button>
    <button class="mobile-nav-btn" (click)="toggleSkills()" [class.active]="showSkills()">
      <span>{{ t().hardAndSoftSkills }}</span>
    </button>
  </div>
</div>
